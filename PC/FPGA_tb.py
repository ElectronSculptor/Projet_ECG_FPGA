
# affichage ecg avec ascon fpga
from FPGA import *

KEY =   bytes.fromhex('4B8A55114D1CB6A9A2BE263D4D7AECAAFF')
NONCE = bytes.fromhex('4E4ED0EC0B98C529B7C8CDDF37BCD0284A')
DA =    bytes.fromhex('444120746F20428000')
WAVE =  bytes.fromhex('575A5B5B5A5A5A5A5A59554E4A4C4F545553515354565758575A5A595756595B5A5554545252504F4F4C4C4D4D4A49444447474644424341403B36383E4449494747464644434243454745444546474A494745484F58697C92AECEEDFFFFE3B47C471600041729363C3F3E40414141403F3F403F3E3B3A3B3E3D3E3C393C41464646454447464A4C4F4C505555524F5155595C5A595A5C5C5B5959575351504F4F53575A5C5A5B5D5E6060615F605F5E5A5857545252800000')


fpga = FPGA('COM6', 115200)
fpga.open_instrument()
fpga.send_key(KEY)
fpga.send_nonce(NONCE)
fpga.send_associated_data(DA)
fpga.send_waveform(WAVE)
fpga.start_encryption()
cipher = fpga.get_cipher()
tag = fpga.get_tag()
fpga.close_instrument()

plain = fpga.decrypt_waveform_python(cipher[:-3]+tag, KEY[1:], NONCE[1:], DA[1:-2])
print(plain == WAVE[1:-3])
